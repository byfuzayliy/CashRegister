<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cash Register</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f5f5f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        background-color: white;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 500px;
        padding: 25px;
      }

      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 20px;
      }

      .info-box {
        background-color: #f8f9fa;
        border-left: 4px solid #3498db;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
      }

      .info-box h3 {
        color: #3498db;
        margin-bottom: 8px;
      }

      .input-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
      }

      input {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }

      button {
        width: 100%;
        padding: 12px;
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #27ae60;
      }

      #change-due {
        margin-top: 20px;
        padding: 15px;
        border-radius: 4px;
        background-color: #f8f9fa;
        min-height: 60px;
        font-family: monospace;
        white-space: pre-wrap;
      }

      .status-open {
        color: #27ae60;
        font-weight: bold;
      }

      .status-closed {
        color: #f39c12;
        font-weight: bold;
      }

      .status-insufficient {
        color: #e74c3c;
        font-weight: bold;
      }

      .drawer {
        margin-top: 25px;
      }

      .drawer h3 {
        margin-bottom: 10px;
        color: #2c3e50;
      }

      .drawer-content {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .drawer-item {
        background-color: #f8f9fa;
        padding: 8px;
        border-radius: 4px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Cash Register</h1>

      <div class="info-box">
        <h3>Instructions</h3>
        <p>
          Enter the cash provided by the customer and click "Purchase" to
          calculate change.
        </p>
      </div>

      <div class="input-group">
        <label for="price">Price:</label>
        <input type="number" id="price" value="19.5" step="0.01" disabled />
      </div>

      <div class="input-group">
        <label for="cash">Cash Provided:</label>
        <input
          type="number"
          id="cash"
          placeholder="Enter cash amount"
          step="0.01"
        />
      </div>

      <button id="purchase-btn">Purchase</button>

      <div class="input-group">
        <label for="change-due">Change Due:</label>
        <div id="change-due">Please provide cash and click Purchase</div>
      </div>

      <div class="drawer">
        <h3>Cash Drawer (CID)</h3>
        <div class="drawer-content" id="drawer-content">
          <!-- Drawer content will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <script>
      // Global variables (can be reassigned by tests)
      let price = 19.5;
      let cid = [
        ["PENNY", 1.01],
        ["NICKEL", 2.05],
        ["DIME", 3.1],
        ["QUARTER", 4.25],
        ["ONE", 90],
        ["FIVE", 55],
        ["TEN", 20],
        ["TWENTY", 60],
        ["ONE HUNDRED", 100],
      ];

      // Currency unit values
      const currencyUnitValues = {
        PENNY: 0.01,
        NICKEL: 0.05,
        DIME: 0.1,
        QUARTER: 0.25,
        ONE: 1,
        FIVE: 5,
        TEN: 10,
        TWENTY: 20,
        "ONE HUNDRED": 100,
      };

      // Function to format currency
      function formatCurrency(amount) {
        return `$${amount.toFixed(2)}`;
      }

      // Function to update the drawer display
      function updateDrawerDisplay() {
        const drawerContent = document.getElementById("drawer-content");
        drawerContent.innerHTML = "";

        cid.forEach((item) => {
          const drawerItem = document.createElement("div");
          drawerItem.className = "drawer-item";
          drawerItem.textContent = `${item[0]}: ${formatCurrency(item[1])}`;
          drawerContent.appendChild(drawerItem);
        });
      }

      // Function to calculate change
      function calculateChange(changeDue, cid) {
        let change = [];
        let status = "INSUFFICIENT_FUNDS";
        let totalCID = 0;

        // Calculate total cash in drawer
        for (let i = 0; i < cid.length; i++) {
          totalCID += cid[i][1];
        }
        totalCID = Math.round(totalCID * 100) / 100;

        // Check if cash in drawer is less than change due
        if (totalCID < changeDue) {
          return { status, change };
        }

        // Check if cash in drawer equals change due
        if (totalCID === changeDue) {
          status = "CLOSED";
          change = [...cid];
          return { status, change };
        }

        // Calculate change to be given
        let remainingChange = changeDue;
        let tempCID = JSON.parse(JSON.stringify(cid)); // Deep copy

        // Reverse to start from highest denomination
        const reversedCID = [...tempCID].reverse();
        const reversedCurrencyUnits = Object.entries(currencyUnitValues)
          .reverse()
          .reduce((obj, [key, value]) => {
            obj[key] = value;
            return obj;
          }, {});

        for (let i = 0; i < reversedCID.length; i++) {
          const currencyName = reversedCID[i][0];
          const currencyValue = reversedCurrencyUnits[currencyName];
          let currencyAmount = reversedCID[i][1];
          let currencyCount = 0;

          while (remainingChange >= currencyValue && currencyAmount > 0) {
            remainingChange =
              Math.round((remainingChange - currencyValue) * 100) / 100;
            currencyAmount =
              Math.round((currencyAmount - currencyValue) * 100) / 100;
            currencyCount += currencyValue;
          }

          if (currencyCount > 0) {
            change.push([currencyName, currencyCount]);
            reversedCID[i][1] = currencyAmount;
          }
        }

        // Check if exact change could be given
        if (remainingChange > 0) {
          return { status: "INSUFFICIENT_FUNDS", change: [] };
        }

        status = "OPEN";
        return { status, change };
      }

      // Function to handle purchase button click
      function handlePurchase() {
        const cashInput = document.getElementById("cash");
        const changeDueElement = document.getElementById("change-due");
        const cash = parseFloat(cashInput.value);

        // Validate input
        if (isNaN(cash) || cash < 0) {
          alert("Please enter a valid cash amount.");
          return;
        }

        // Check if cash is less than price
        if (cash < price) {
          alert("Customer does not have enough money to purchase the item");
          return;
        }

        // Check if cash equals price
        if (cash === price) {
          changeDueElement.textContent =
            "No change due - customer paid with exact cash";
          return;
        }

        // Calculate change due
        const changeDue = Math.round((cash - price) * 100) / 100;
        const result = calculateChange(changeDue, cid);

        // Display result
        if (result.status === "INSUFFICIENT_FUNDS") {
          changeDueElement.innerHTML = `<span class="status-insufficient">Status: INSUFFICIENT_FUNDS</span>`;
        } else if (result.status === "CLOSED") {
          let changeText = `<span class="status-closed">Status: CLOSED</span>`;
          result.change.forEach((item) => {
            if (item[1] > 0) {
              changeText += ` ${item[0]}: ${formatCurrency(item[1])}`;
            }
          });
          changeDueElement.innerHTML = changeText;
        } else if (result.status === "OPEN") {
          let changeText = `<span class="status-open">Status: OPEN</span>`;
          result.change.forEach((item) => {
            changeText += ` ${item[0]}: ${formatCurrency(item[1])}`;
          });
          changeDueElement.innerHTML = changeText;
        }

        // Update the drawer display
        updateDrawerDisplay();
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        // Set up event listener for purchase button
        document
          .getElementById("purchase-btn")
          .addEventListener("click", handlePurchase);

        // Initialize drawer display
        updateDrawerDisplay();

        // Set price in the input field
        document.getElementById("price").value = price;
      });
    </script>
  </body>
</html>
